name: PR Size Labeler

# Labels PRs based on the size of changes
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  size-label:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    
    steps:
    - name: Label PR based on size
      uses: actions/github-script@v7
      with:
        script: |
          const { data: pr } = await github.rest.pulls.get({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: context.issue.number,
          });
          
          const additions = pr.additions;
          const deletions = pr.deletions;
          const total = additions + deletions;
          
          // Remove existing size labels
          const { data: labels } = await github.rest.issues.listLabelsOnIssue({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
          });
          
          const sizeLabels = labels.filter(label => label.name.startsWith('size/')).map(label => label.name);
          
          for (const label of sizeLabels) {
            await github.rest.issues.removeLabel({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              name: label,
            });
          }
          
          // Determine size label
          let sizeLabel;
          if (total < 10) {
            sizeLabel = 'size/XS';
          } else if (total < 50) {
            sizeLabel = 'size/S';
          } else if (total < 250) {
            sizeLabel = 'size/M';
          } else if (total < 1000) {
            sizeLabel = 'size/L';
          } else {
            sizeLabel = 'size/XL';
          }
          
          // Add new size label
          await github.rest.issues.addLabels({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
            labels: [sizeLabel],
          });
          
          console.log(`PR size: ${total} lines (+${additions}/-${deletions})`);
          console.log(`Applied label: ${sizeLabel}`);
